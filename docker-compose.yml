services:

  uhf-server:

    image: solidpixel/uhf-server:uhf-1.4.0-ffmpeg7.1.1-d1
    container_name: uhf-server
    restart: unless-stopped

    volumes:
      # Persist recordings and database
      - ./uhf-data:/var/lib/uhf-server

      # OPTIONAL: store recordings in a different location
      # Uncomment the line below IN ADDITION to the one above
      # This overrides only /recordings inside the container
      # - ./uhf-recordings:/var/lib/uhf-server/recordings

    ports:
      - 8000:8000  # <HOST>:<CONTAINER>

    # Optional container environment config
    # Uncomment to customize internal container settings
    environment:
      - ENABLE_COMMERCIAL_DETECTION=false  # set true for detection
      # - PASSWORD=
      # - API_HOST=0.0.0.0
      # - API_PORT=8000
      # - RECORDINGS_DIR=/var/lib/uhf-server/recordings
      # - DB_PATH=/var/lib/uhf-server/db.json
      # - LOG_LEVEL=INFO  # Options: DEBUG, INFO, WARNING, ERROR, CRITICAL

    # Simple command with conditional commercial detection and password flags
    command:
      - sh
      - -c
      - |
          exec uhf-server \
            ${ENABLE_COMMERCIAL_DETECTION:+--enable-commercial-detection} \
            ${PASSWORD:+--password "$PASSWORD"}

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/server/stats"]
      interval: 30s
      timeout: 5s
      retries: 3
      # update URL if API_PORT changes
